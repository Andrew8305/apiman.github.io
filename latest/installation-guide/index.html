<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory">apiman - Installation Guide</title><link rel="stylesheet" href="css/jbossorg.css" type="text/css"/><meta xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" name="generator" content="DocBook XSL-NS Stylesheets V1.74.0"/><meta xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" http-equiv="Content-Type" content="text/html; charset=UTF-8"/></head><body><div class="book" lang="en-US"><div class="titlepage"><div><p xmlns:d="http://docbook.org/ns/docbook" id="title"><a href="http://www.jboss.org" class="site_href"><strong>JBoss.org</strong></a><a href="http://docs.jboss.org/" class="doc_href"><strong>Community Documentation</strong></a></p><div><h1 class="title"><a id="d0e3"/>apiman - Installation Guide</h1></div></div><hr/></div><div class="toc"><dl><dt><span class="chapter"><a href="#_installation">1. Installation</a></span></dt><dd><dl><dt><span class="section"><a href="#_installing_in_wildfly_8">1.1. Installing in WildFly 8</a></span></dt><dd><dl><dt><span class="section"><a href="#_download">1.1.1. Download</a></span></dt><dt><span class="section"><a href="#_unpack">1.1.2. Unpack</a></span></dt><dt><span class="section"><a href="#_run_wildfly_8">1.1.3. Run WildFly 8</a></span></dt></dl></dd><dt><span class="section"><a href="#_installing_using_docker">1.2. Installing using Docker</a></span></dt></dl></dd><dt><span class="chapter"><a href="#_configuration">2. Configuration</a></span></dt><dd><dl><dt><span class="section"><a href="#_configuration_properties">2.1. Configuration Properties</a></span></dt><dt><span class="section"><a href="#_api_manager_database">2.2. API Manager Database</a></span></dt><dt><span class="section"><a href="#_api_gateway_registry">2.3. API Gateway Registry</a></span></dt></dl></dd></dl></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_installation"/>Chapter 1. Installation</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#_installing_in_wildfly_8">1.1. Installing in WildFly 8</a></span></dt><dd><dl><dt><span class="section"><a href="#_download">1.1.1. Download</a></span></dt><dt><span class="section"><a href="#_unpack">1.1.2. Unpack</a></span></dt><dt><span class="section"><a href="#_run_wildfly_8">1.1.3. Run WildFly 8</a></span></dt></dl></dd><dt><span class="section"><a href="#_installing_using_docker">1.2. Installing using Docker</a></span></dt></dl></div><p>This guide provides detailed information about how to install and configure apiman.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_installing_in_wildfly_8"/>1.1. Installing in WildFly 8</h2></div></div></div><p>The apiman project primarily targets WildFly 8 as a runtime environment.  In order to install
apiman you will need to download both WildFly 8 and the apiman overlay distribution.  Once
both are downloaded, it’s a simple matter of unpacking both into the same location.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_download"/>1.1.1. Download</h3></div></div></div><p>First you will need to download both WildFly 8 and apiman:</p><div class="itemizedlist"><ul><li><a class="ulink" href="http://download.jboss.org/wildfly/8.1.0.Final/wildfly-8.1.0.Final.zip">Download WildFly 8</a></li><li><a class="ulink" href="http://downloads.jboss.org/overlord/apiman/1.0.0.Beta1/apiman-distro-wildfly8-1.0.0.Beta1-overlay.zip">Download apiman 1.0.0.Beta1</a></li></ul></div><pre class="literallayout">curl http://download.jboss.org/wildfly/8.1.0.Final/wildfly-8.1.0.Final.zip -o wildfly-8.1.0.Final.zip
curl http://downloads.jboss.org/overlord/apiman/1.0.0.Beta1/apiman-distro-wildfly8-1.0.0.Beta1-overlay.zip -o apiman-distro-wildfly8-1.0.0.Beta1-overlay.zip</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_unpack"/>1.1.2. Unpack</h3></div></div></div><p>Once both files have been downloaded, simply unpack both in the same location.</p><pre class="literallayout">unzip wildfly-8.1.0.Final.zip
unzip apiman-distro-wildfly8-1.0.0.Beta1-overlay.zip</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h3 class="title"><a id="_run_wildfly_8"/>1.1.3. Run WildFly 8</h3></div></div></div><p>The apiman overlay contains everything needed to run apiman, including:</p><div class="itemizedlist"><ul><li>apiman binaries (several WAR files)</li><li>apiman-specific WildFly 8 configuration (<span class="strong"><strong>standalone-apiman.xml</strong></span>)</li><li>apiman rdbms datasource (h2)</li><li>pre-configured <span class="strong"><strong>admin</strong></span> user with password <span class="strong"><strong>admin123!</strong></span></li></ul></div><p>For this reason, there is no additional configuration required to run apiman.  Simply start up
WildFly using the apiman configuration file:</p><pre class="literallayout">cd wildfly-8.1.0.Final
./bin/standalone.sh -c standalone-apiman.xml</pre></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_installing_using_docker"/>1.2. Installing using Docker</h2></div></div></div><p>Another option when installing apiman is to use our docker image.  You’re probably pretty
familiar with docker if you’re going that route, but here is an example of how to start up
the apiman docker image:</p><pre class="literallayout">docker pull apiman/on-wildfly8
docker run -it -p 8080:8080 apiman/on-wildfly8</pre><div xmlns:d="http://docbook.org/ns/docbook" xmlns:rf="java:org.jboss.highlight.XhtmlRendererFactory" class="note"><h2>Note</h2><p>You can find apiman on <a class="ulink" href="https://registry.hub.docker.com/repos/apiman/">docker hub</a>.</p></div></div></div><div class="chapter" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_configuration"/>Chapter 2. Configuration</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="#_configuration_properties">2.1. Configuration Properties</a></span></dt><dt><span class="section"><a href="#_api_manager_database">2.2. API Manager Database</a></span></dt><dt><span class="section"><a href="#_api_gateway_registry">2.3. API Gateway Registry</a></span></dt></dl></div><p>Of course apiman is made up of a number of different components, many of which can be configured
to use various implementations and/or providers.  When downloading and installing apiman, the
default distribution includes reasonable default values for all options.  This section details
these options and explains the default values.</p><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_configuration_properties"/>2.1. Configuration Properties</h2></div></div></div><p>All of the apiman WARs share a common configuration file called <span class="strong"><strong>apiman.properties</strong></span>, which can
be found in <span class="strong"><strong>standalone/configuration</strong></span>.  This file therefore contains configuration settings
for all three applications (API Manager, API Manager UI, API Gateway).</p><p>Here is a breakdown of the properties found in this configuration file:</p><div class="itemizedlist"><ul><li><p><span class="strong"><strong>apiman-manager-api.gateway.rest-endpoint</strong></span></p><div class="variablelist"><dl><dt><span class="term">Default Value</span></dt><dd><a class="ulink" href="http://localhost:8080/apiman-gateway">http://localhost:8080/apiman-gateway</a></dd><dt><span class="term">Description</span></dt><dd>The REST configuration endpoint of the API Gateway.  The API Manager uses this endpoint when publishing services to the Gateway.</dd></dl></div></li><li><p><span class="strong"><strong>apiman-manager-api.gateway.authentication.basic.user</strong></span></p><div class="variablelist"><dl><dt><span class="term">Default Value</span></dt><dd>admin</dd><dt><span class="term">Description</span></dt><dd>The username to use when connecting to the Gateway REST API.</dd></dl></div></li><li><p><span class="strong"><strong>apiman-manager-api.gateway.authentication.basic.password</strong></span></p><div class="variablelist"><dl><dt><span class="term">Default Value</span></dt><dd>admin123!</dd><dt><span class="term">Description</span></dt><dd>The password to use when connecting to the Gatway REST API.</dd></dl></div></li><li><p><span class="strong"><strong>apiman-manager-ui.dt-api.authentication.type</strong></span></p><div class="variablelist"><dl><dt><span class="term">Default Value</span></dt><dd>authToken</dd><dt><span class="term">Description</span></dt><dd>The type of authentication used by the API Manager UI when communicating with the API Manager.</dd></dl></div></li><li><p><span class="strong"><strong>apiman-manager-ui.dt-api.authentication.token.generator</strong></span></p><div class="variablelist"><dl><dt><span class="term">Default Value</span></dt><dd>io.apiman.manager.ui.server.auth.AuthTokenGenerator</dd><dt><span class="term">Description</span></dt><dd>The class used by the UI to generate authentication tokens (only used for certain types of authentication).</dd></dl></div></li><li><p><span class="strong"><strong>apiman-manager-ui.gateway.base-url</strong></span></p><div class="variablelist"><dl><dt><span class="term">Default Value</span></dt><dd><a class="ulink" href="http://localhost:8080/apiman-gateway/gateway/">http://localhost:8080/apiman-gateway/gateway/</a></dd><dt><span class="term">Description</span></dt><dd>The base URL of the API Gateway - used by the UI to show URLs for service contracts.</dd></dl></div></li><li><p><span class="strong"><strong>apiman-gateway.registry</strong></span></p><div class="variablelist"><dl><dt><span class="term">Default Value</span></dt><dd>io.apiman.gateway.engine.ispn.InfinispanRegistry</dd><dt><span class="term">Description</span></dt><dd>The implementation of the service/application registry used by the API Gateway.  By default a persistent Infinispan cache is used.</dd></dl></div></li><li><p><span class="strong"><strong>apiman-gateway.connector-factory</strong></span></p><div class="variablelist"><dl><dt><span class="term">Default Value</span></dt><dd>io.apiman.gateway.platforms.servlet.connectors.HttpConnectorFactory</dd><dt><span class="term">Description</span></dt><dd>The implementation of a connector factory for API endpoints of type "http".  This factory is used by the Gateway when proxying a request to a back-end endpoint.</dd></dl></div></li><li><p><span class="strong"><strong>apiman-gateway.policy-factory</strong></span></p><div class="variablelist"><dl><dt><span class="term">Default Value</span></dt><dd>io.apiman.gateway.engine.policy.PolicyFactoryImpl</dd><dt><span class="term">Description</span></dt><dd>The class that the API Gateway will use creating policies.</dd></dl></div></li><li><p><span class="strong"><strong>apiman-gateway.components.ISharedStateComponent</strong></span></p><div class="variablelist"><dl><dt><span class="term">Default Value</span></dt><dd>io.apiman.gateway.engine.impl.InMemorySharedStateComponent</dd><dt><span class="term">Description</span></dt><dd>The implementation of the shared-state component - a component that can store arbitrary state across request invocations.</dd></dl></div></li><li><p><span class="strong"><strong>apiman-gateway.components.IRateLimiterComponent</strong></span></p><div class="variablelist"><dl><dt><span class="term">Default Value</span></dt><dd>io.apiman.gateway.engine.impl.InMemoryRateLimiterComponent</dd><dt><span class="term">Description</span></dt><dd>The implementation of the rate limiter component, which is used by the rate limiting policy.</dd></dl></div></li><li><p>*apiman-gateway.components.IPolicyFailureFactoryComponent</p><div class="variablelist"><dl><dt><span class="term">Default Value</span></dt><dd>io.apiman.gateway.platforms.servlet.PolicyFailureFactoryComponent</dd><dt><span class="term">Description</span></dt><dd>The implementation class to use for the factory that creates policy failures.</dd></dl></div></li></ul></div></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_api_manager_database"/>2.2. API Manager Database</h2></div></div></div><p>The API Manager, by default, is a typical CDI application and uses JPA/Hibernate to persist its data.  The
JPA layer requires a data source to connect to a supported database.  When running in WildFly this
datasource is made available by deploying the following file:</p><pre class="literallayout">standalone/deployments/apiman-ds.xml</pre><p>Out of the box this data source is usually a simple H2 configuration, but you can (of course) change
it to support whatever database you desire.</p><pre class="literallayout">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;datasources&gt;
  &lt;datasource jndi-name="jdbc/ApiManDT" pool-name="apiman-manager-api" enabled="true"
    use-java-context="true"&gt;
    &lt;connection-url&gt;jdbc:h2:${jboss.server.data.dir}${/}h2${/}apiman-manager-api;MVCC=true&lt;/connection-url&gt;
    &lt;driver&gt;h2&lt;/driver&gt;
    &lt;security&gt;
      &lt;user-name&gt;sa&lt;/user-name&gt;
    &lt;/security&gt;
  &lt;/datasource&gt;
&lt;/datasources&gt;</pre></div><div class="section" lang="en-US"><div class="titlepage"><div><div><h2 class="title"><a id="_api_gateway_registry"/>2.3. API Gateway Registry</h2></div></div></div><p>The API Gateway includes a registry that stores the published service and application information.
This registry is updated whenever a user publishes a service (or registers an application) from
within the API Manager UI.  The registry contains just the configuration information necessary for
the API Gateway to properly apply the appropriate policies to all inbound requests.</p><p>Out of the box, the API Gateway is configured to use a persistent Infinispan cache to store the
published/registered data.  The configuration of the Infinispan cache can be found in
<span class="strong"><strong>standalone-apiman.xml</strong></span> and is detailed here:</p><pre class="literallayout">&lt;subsystem xmlns="urn:jboss:domain:infinispan:2.0"&gt;
  &lt;cache-container name="apiman-gateway" default-cache="registry" start="EAGER"&gt;
    &lt;local-cache name="registry" batching="true"&gt;
      &lt;file-store passivation="false" purge="false" /&gt;
    &lt;/local-cache&gt;
  &lt;/cache-container&gt;
&lt;/subsystem&gt;</pre><p>This cache can be configured however you choose, but in all cases should be made persistent.</p></div></div></div></body></html>